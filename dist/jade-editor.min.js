/**
 * jade-editor
 * @version v0.2.0 - 2015-06-09
 * @link http://jade-editor.org
 * @author ZHAO Xudong (zxdong@gmail.com)
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
!function(t,e,n){function i(t,e){this.init(t,e)}i.keycodes={keyup:{13:"enter",73:"i",66:"b"},keydown:{9:"tab",8:"backspace",222:"single_quote",57:"left_bracket",219:"open_bracket",221:"close_bracket"}},i.prototype.init=function(t,n){var i={indent:"    "},s=n||{};this.dom=e.getElementById(t),this.pre=this.dom.nextSibling,this.options={},this.options.indent=s.indent||i.indent,this.inited=!0,this.evt()},i.prototype.evt=function(){var t=this,e=t.dom;e.addEventListener("keyup",function(e,n){var s=e.keyCode,o=i.keycodes.keyup[s];return o?void t["handleKeyEvt_"+o](e,t.updateSyntax):t.updateSyntax()},!1),e.addEventListener("keydown",function(e,n){var s=e.keyCode,o=i.keycodes.keydown[s];return o?void t["handleKeyEvt_"+o](e,t.updateSyntax):t.updateSyntax()},!1),t.autoGrow()},i.prototype.updateSyntax=function(){var t=this,e=t.dom,n=t.pre;n&&(n.innerHTML=e.value,n.classList.remove("prettyprinted"),prettyPrint())},i.prototype.autoGrow=function(){var t=this.dom;t.scrollHeight>t.clientHeight&&(t.style.height=t.scrollHeight+"px")},i.prototype.handleKeyEvt_tab=function(t,e){t.preventDefault();var n=this,i=n.options,s=n.dom,o=s.selectionStart,r=s.selectionEnd,l=s.value,a=l.substring(o,r),u=l.substring(o-1,o);"\n"!==u&&""!==u?s.value=l.substring(0,o)+i.indent+l.substring(r):(a=i.indent+a.replace(/\n/g,"\n"+i.indent),s.value=l.substring(0,o)+a+l.substring(r),s.selectionStart=o===r?o+i.indent.length:o,s.selectionEnd=o===r?o+i.indent.length:o+a.length),e()},i.prototype.handleKeyEvt_enter=function(t,e){var n=this,i=n.options,s=n.dom,o=s.selectionStart,r=s.selectionEnd,l=s.value,a=l.substring(0,o).split("\n"),u=a.length,d=a[u-2],c=/^( *)/,p=d.match(c),v=p[1];s.value=l.substring(0,o)+v+i.indent+l.substring(r),e()},i.prototype.handleKeyEvt_backspace=function(t,e){var n=this,i=n.options,s=i.indent,o=s.length,r=n.dom,l=r.selectionStart,a=r.selectionEnd,u=r.value,d=u.substring(0,l),c=d.split("\n"),p=c.length,v=c[p-1],h=/^ *$/.test(v),g=l-v.length,y=u.substring(g,l),b=y.length;!h||o>b||(t.preventDefault(),r.value=u.substring(0,g)+y.replace(s,"")+u.substring(a),e())},i.prototype.handleKeyEvt_open_bracket=function(t,e){var n=this,i=n.options,s=n.dom,o=s.selectionStart,r=s.selectionEnd,l=s.value,a=l.substring(o,r),u=t.shiftKey?"{":"[",d=t.shiftKey?"}":"]";if(t.preventDefault(),!t.ctrlKey)return s.value=l.substring(0,o)+u+a+d+l.substring(r),s.selectionStart=o===r?o+1:o,s.selectionEnd=r+(o===r?1:2),e();var c=!a.length;if(c){var p=l.substring(0,o).split("\n"),v=p.length;a=p[v-1];var h=o-a.length,g=l.substring(0,h)}for(var y=a.split("\n"),b=y.length,f=[],E=new RegExp("^"+i.indent),S=0;b>S;S++)f.push(y[S].replace(E,""));a=f.join("\n"),c?(s.value=g+a+l.substring(r),s.selectionStart=g.length,s.selectionEnd=g.length):(s.value=l.substring(0,o)+a+l.substring(r),s.selectionStart=o,s.selectionEnd=o+(o===r?0:a.length+1)),e()},i.prototype.handleKeyEvt_close_bracket=function(t,e){return t.ctrlKey?this.handleKeyEvt_tab(t,e):void 0},i.prototype.handleKeyEvt_single_quote=function(t,e){var n=this,i=(n.options,n.dom),s=i.selectionStart,o=i.selectionEnd,r=i.value,l=t.shiftKey?'"':"'";t.preventDefault(),i.value=r.substring(0,s)+l+r.substring(s,o)+l+r.substring(o),i.selectionStart=s===o?s+1:s,i.selectionEnd=o+(s===o?1:2),e()},i.prototype.handleKeyEvt_left_bracket=function(t,e){{var n=this,i=(n.options,n.dom),s=i.selectionStart,o=i.selectionEnd,r=i.value;t.shiftKey?'"':"'"}t.shiftKey&&(t.preventDefault(),i.value=r.substring(0,s)+"("+r.substring(s,o)+")"+r.substring(o),i.selectionStart=s===o?s+1:s,i.selectionEnd=o+(s===o?1:2),e())},i.prototype.handleKeyEvt_i=function(t,e){var n=this,i=(n.options,n.dom),s=i.selectionStart,o=i.selectionEnd,r=i.value;t.ctrlKey&&(t.preventDefault(),i.value=r.substring(0,s)+"<i>"+r.substring(s,o)+"</i>"+r.substring(o),i.selectionStart=s===o?s+3:s,i.selectionEnd=o+(s===o?3:7),e())},i.prototype.handleKeyEvt_b=function(t,e){var n=this,i=(n.options,n.dom),s=i.selectionStart,o=i.selectionEnd,r=i.value;t.ctrlKey&&(t.preventDefault(),i.value=r.substring(0,s)+"<b>"+r.substring(s,o)+"</b>"+r.substring(o),i.selectionStart=s===o?s+3:s,i.selectionEnd=o+(s===o?3:7),e())},t.JadeEditor=i}(window,document);