/**
 * jade-editor
 * @version v0.0.1 - 2015-06-08
 * @link http://html5beta.com/apps/jade-editor
 * @author ZHAO Xudong (zxdong@gmail.com)
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
!function(t,e,n){function i(t,e){this.init(t,e)}i.keycodes={keyup:{13:"enter",73:"i",66:"b"},keydown:{9:"tab",8:"backspace",222:"single_quote",57:"left_bracket",219:"open_bracket",221:"close_bracket"}},i.prototype.init=function(t,n){var i={indent:"    "},s=n||{};this.dom=e.getElementById(t),this.options={},this.options.indent=s.indent||i.indent,this.inited=!0,this.evt()},i.prototype.evt=function(){var t=this,e=t.dom;e.addEventListener("keyup",function(e){var n=e.keyCode,s=i.keycodes.keyup[n];s&&t["handleKeyEvt_"+s](e)},!1),e.addEventListener("keydown",function(e){var n=e.keyCode,s=i.keycodes.keydown[n];s&&t["handleKeyEvt_"+s](e)},!1),t.autoGrow()},i.prototype.autoGrow=function(){var t=this.dom;t.scrollHeight>t.clientHeight&&(t.style.height=t.scrollHeight+"px")},i.prototype.handleKeyEvt_tab=function(t){t.preventDefault();var e=this,n=e.options,i=e.dom,s=i.selectionStart,o=i.selectionEnd,r=i.value,l=r.substring(s,o),u=r.substring(s-1,s);"\n"!==u&&""!==u?i.value=r.substring(0,s)+n.indent+r.substring(o):(l=n.indent+l.replace(/\n/g,"\n"+n.indent),i.value=r.substring(0,s)+l+r.substring(o))},i.prototype.handleKeyEvt_enter=function(t){var e=this,n=e.options,i=e.dom,s=i.selectionStart,o=i.selectionEnd,r=i.value,l=r.substring(0,s).split("\n"),u=l.length,a=l[u-2],d=/^( *)/,v=a.match(d),c=v[1];i.value=r.substring(0,s)+c+n.indent+r.substring(o)},i.prototype.handleKeyEvt_backspace=function(t){var e=this,n=e.options,i=n.indent,s=i.length,o=e.dom,r=o.selectionStart,l=o.selectionEnd,u=o.value,a=u.substring(0,r),d=a.split("\n"),v=d.length,c=d[v-1],p=/^ *$/.test(c),g=r-c.length,h=u.substring(g,r),b=h.length;!p||s>b||(t.preventDefault(),o.value=u.substring(0,g)+h.replace(i,"")+u.substring(l))},i.prototype.handleKeyEvt_open_bracket=function(t){var e=this,n=e.options,i=e.dom,s=i.selectionStart,o=i.selectionEnd,r=i.value,l=r.substring(s,o),u=t.shiftKey?"{":"[",a=t.shiftKey?"}":"]";if(t.preventDefault(),!t.ctrlKey)return i.value=r.substring(0,s)+u+l+a+r.substring(o);var d=!l.length;if(d){var v=r.substring(0,s).split("\n"),c=v.length;l=v[c-1];var p=s-l.length,g=r.substring(0,p)}for(var h=l.split("\n"),b=h.length,y=[],f=new RegExp("^"+n.indent),E=0;b>E;E++)y.push(h[E].replace(f,""));return l=y.join("\n"),d?i.value=g+l+r.substring(o):void(i.value=r.substring(0,s)+l+r.substring(o))},i.prototype.handleKeyEvt_close_bracket=function(t){return t.ctrlKey?this.handleKeyEvt_tab(t):void 0},i.prototype.handleKeyEvt_single_quote=function(t){var e=this,n=(e.options,e.dom),i=n.selectionStart,s=n.selectionEnd,o=n.value,r=t.shiftKey?'"':"'";t.preventDefault(),n.value=o.substring(0,i)+r+o.substring(i,s)+r+o.substring(s)},i.prototype.handleKeyEvt_left_bracket=function(t){{var e=this,n=(e.options,e.dom),i=n.selectionStart,s=n.selectionEnd,o=n.value;t.shiftKey?'"':"'"}t.shiftKey&&(t.preventDefault(),n.value=o.substring(0,i)+"("+o.substring(i,s)+")"+o.substring(s))},i.prototype.handleKeyEvt_i=function(t){var e=this,n=(e.options,e.dom),i=n.selectionStart,s=n.selectionEnd,o=n.value;t.ctrlKey&&(t.preventDefault(),n.value=o.substring(0,i)+"<i>"+o.substring(i,s)+"</i>"+o.substring(s))},i.prototype.handleKeyEvt_b=function(t){var e=this,n=(e.options,e.dom),i=n.selectionStart,s=n.selectionEnd,o=n.value;t.ctrlKey&&(t.preventDefault(),n.value=o.substring(0,i)+"<b>"+o.substring(i,s)+"</b>"+o.substring(s))},t.JadeEditor=i}(window,document);